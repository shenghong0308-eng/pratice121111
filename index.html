<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>æˆ‘çš„æ¯æ—¥ä»»å‹™ç³»çµ±</title>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: 20px auto; padding: 20px; background-color: #f4f4f9; }
        .card { background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .task-item { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding: 10px 0; }
        button { cursor: pointer; background: #007bff; color: white; border: none; padding: 8px 12px; border-radius: 4px; }
        button:disabled { background: #ccc; }
        .score { font-size: 1.2em; color: #28a745; font-weight: bold; }
    </style>
</head>
<body>

    <h1>ğŸ“… æ¯æ—¥ä»»å‹™ç³»çµ±</h1>
    <div class="card">
        <p>ç•¶å‰ç¸½ç©åˆ†ï¼š<span id="totalScore" class="score">0</span></p>
        <button id="drawBtn" onclick="drawTasks()">æŠ½å–ä»Šæ—¥ä»»å‹™ (æ¯æ—¥é™ä¸€æ¬¡)</button>
    </div>

    <div id="todayTasks" class="card">
        <h3>ä»Šæ—¥ä»»å‹™ï¼š</h3>
        <div id="taskList">è«‹å…ˆæŠ½å–ä»»å‹™...</div>
    </div>

    <div class="card">
        <h3>æ–°å¢ä»»å‹™æ± ï¼š</h3>
        <input type="text" id="taskInput" placeholder="è¼¸å…¥ä»»å‹™æŒ‡ä»¤ï¼ˆå¦‚ï¼šè·‘æ­¥ï¼‰">
        <select id="difficultyInput">
            <option value="10">ç°¡å–® (10åˆ†)</option>
            <option value="30">ä¸­ç­‰ (30åˆ†)</option>
            <option value="50">å›°é›£ (50åˆ†)</option>
        </select>
        <button onclick="addTaskToPool()">æ–°å¢ä»»å‹™</button>
    </div>

    <script>
        // 1. åˆå§‹åŒ–è³‡æ–™ (å¦‚æœ LocalStorage æ²’è³‡æ–™å°±çµ¦é è¨­å€¼)
        let taskPool = JSON.parse(localStorage.getItem('taskPool')) || [
            { cmd: "å– 2000cc æ°´", difficulty: 10 },
            { cmd: "é–±è®€ 30 åˆ†é˜", difficulty: 30 },
            { cmd: "é‹å‹• 1 å°æ™‚", difficulty: 50 }
        ];
        let score = parseInt(localStorage.getItem('score')) || 0;
        let todayTasks = JSON.parse(localStorage.getItem('todayTasks')) || [];

        // æ›´æ–°ç•«é¢ä¸Šçš„åˆ†æ•¸
        document.getElementById('totalScore').innerText = score;

        // 2. æ–°å¢ä»»å‹™åˆ°ä»»å‹™æ± 
        function addTaskToPool() {
            const cmd = document.getElementById('taskInput').value;
            const diff = parseInt(document.getElementById('difficultyInput').value);
            
            if (cmd === "") return alert("è«‹è¼¸å…¥æŒ‡ä»¤");
            
            taskPool.push({ cmd: cmd, difficulty: diff });
            localStorage.setItem('taskPool', JSON.stringify(taskPool)); // æ°¸ä¹…å„²å­˜
            alert("ä»»å‹™å·²åŠ å…¥ä»»å‹™æ± ï¼");
            document.getElementById('taskInput').value = "";
        }

        // 3. éš¨æ©ŸæŠ½å– 3 å€‹ä»»å‹™
        function drawTasks() {
            if (taskPool.length < 3) return alert("ä»»å‹™æ± è‡³å°‘éœ€è¦ 3 å€‹ä»»å‹™æ‰èƒ½æŠ½å–ï¼");
            
            // éš¨æ©Ÿæ‰“äº‚ä¸¦å–å‰ä¸‰å€‹
            const shuffled = [...taskPool].sort(() => 0.5 - Math.random());
            todayTasks = shuffled.slice(0, 3).map(t => ({ ...t, completed: false }));
            
            saveAndRender();
        }

        // 4. å®Œæˆä»»å‹™åŠ åˆ†
        function completeTask(index) {
            if (todayTasks[index].completed) return;
            
            score += todayTasks[index].difficulty;
            todayTasks[index].completed = true;
            
            localStorage.setItem('score', score);
            document.getElementById('totalScore').innerText = score;
            saveAndRender();
        }

        // å„²å­˜ä»Šæ—¥ç‹€æ…‹ä¸¦æ¸²æŸ“ç•«é¢
        function saveAndRender() {
            localStorage.setItem('todayTasks', JSON.stringify(todayTasks));
            const listDiv = document.getElementById('taskList');
            listDiv.innerHTML = "";

            todayTasks.forEach((task, index) => {
                const div = document.createElement('div');
                div.className = 'task-item';
                div.innerHTML = `
                    <span>${task.cmd} (${task.difficulty}åˆ†)</span>
                    <button onclick="completeTask(${index})" ${task.completed ? 'disabled' : ''}>
                        ${task.completed ? 'å·²å®Œæˆ' : 'é»æ“Šå®Œæˆ'}
                    </button>
                `;
                listDiv.appendChild(div);
            });
        }

        // åˆæ¬¡åŠ è¼‰æ™‚æ¸²æŸ“ä»Šæ—¥ä»»å‹™
        if (todayTasks.length > 0) saveAndRender();
    </script>
</body>
</html>
