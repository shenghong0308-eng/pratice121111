<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¯æ—¥ä»»å‹™æŠ½å¡ç³»çµ±</title>
    <style>
        :root { --primary: #4a90e2; --success: #27ae60; --danger: #e74c3c; --bg: #f5f7fa; }
        body { font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; background-color: var(--bg); color: #333; max-width: 600px; margin: 0 auto; padding: 20px; }
        .card { background: white; border-radius: 15px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; }
        h1, h2 { text-align: center; color: var(--primary); }
        
        .score-board { text-align: center; font-size: 24px; font-weight: bold; color: var(--success); }
        
        .task-list { margin-top: 15px; }
        .task-item { display: flex; justify-content: space-between; align-items: center; padding: 12px; border-bottom: 1px solid #eee; }
        .task-item:last-child { border-bottom: none; }
        
        .btn { border: none; border-radius: 8px; padding: 10px 15px; cursor: pointer; transition: 0.2s; font-weight: bold; }
        .btn-main { background: var(--primary); color: white; width: 100%; font-size: 18px; margin: 10px 0; }
        .btn-success { background: var(--success); color: white; }
        .btn-danger { background: var(--danger); color: white; padding: 5px 10px; font-size: 12px; }
        .btn:disabled { background: #ccc; cursor: not-allowed; }

        .input-group { display: flex; flex-direction: column; gap: 10px; }
        input, select { padding: 10px; border: 1px solid #ddd; border-radius: 8px; }
        
        .tag { font-size: 12px; padding: 2px 6px; border-radius: 4px; margin-left: 5px; color: white; }
        .diff-10 { background: #8e44ad; } /* ç°¡å–® */
        .diff-30 { background: #f39c12; } /* ä¸­ç­‰ */
        .diff-50 { background: #c0392b; } /* å›°é›£ */
    </style>
</head>
<body>

    <div class="card">
        <h1>ğŸŒŸ æ¯æ—¥æŒ‘æˆ°</h1>
        <div class="score-board">ç•¶å‰ç©åˆ†ï¼š<span id="scoreDisplay">0</span></div>
        <button class="btn btn-main" onclick="drawThreeTasks()">ğŸ² æŠ½å–ä»Šæ—¥ä»»å‹™ (3å€‹)</button>
    </div>

    <div class="card">
        <h2>ğŸ¯ ä»Šæ—¥ä»»å‹™æ¸…å–®</h2>
        <div id="todayDisplay" class="task-list">å°šæœªæŠ½å–ä»»å‹™</div>
    </div>

    <div class="card">
        <h2>ğŸ› ï¸ ä»»å‹™åº«ç®¡ç†</h2>
        <div class="input-group">
            <input type="text" id="newTaskCmd" placeholder="è¼¸å…¥æ–°ä»»å‹™åç¨±...">
            <select id="newTaskDiff">
                <option value="10">ç°¡å–® (10ç©åˆ†)</option>
                <option value="30">ä¸­ç­‰ (30ç©åˆ†)</option>
                <option value="50">å›°é›£ (50ç©åˆ†)</option>
            </select>
            <button class="btn btn-success" onclick="addNewTask()">ï¼‹ æ–°å¢åˆ°ä»»å‹™åº«</button>
        </div>
        <hr>
        <div id="poolDisplay" class="task-list"></div>
    </div>

    <script>
        // --- 1. è³‡æ–™åˆå§‹åŒ– ---
        // é è¨­ä»»å‹™åº«ï¼ˆå¦‚æœç©å®¶æ˜¯ç¬¬ä¸€æ¬¡æ‰“é–‹ç¶²é ï¼‰
        const defaultPool = [
            { cmd: "æ·±è¹² 20 ä¸‹", difficulty: 10 },
            { cmd: "é–±è®€ä¸€ç¯‡æ–‡ç« ", difficulty: 30 },
            { cmd: "æ•´ç†æˆ¿é–“ 15 åˆ†é˜", difficulty: 50 }
        ];

        let taskPool = JSON.parse(localStorage.getItem('myTaskPool')) || defaultPool;
        let totalScore = parseInt(localStorage.getItem('myTotalScore')) || 0;
        let todayTasks = JSON.parse(localStorage.getItem('myTodayTasks')) || [];

        // --- 2. é é¢å•Ÿå‹•é‚è¼¯ ---
        function init() {
            renderScore();
            renderPool();
            renderToday();
        }

        // --- 3. æ ¸å¿ƒåŠŸèƒ½ ---

        // æŠ½å– 3 å€‹ä»»å‹™
        function drawThreeTasks() {
            if (taskPool.length < 3) {
                alert("ä»»å‹™åº«å¤ªå°‘å•¦ï¼è«‹è‡³å°‘æ–°å¢ 3 å€‹ä»»å‹™ã€‚");
                return;
            }
            // éš¨æ©Ÿæ´—ç‰Œæ¼”ç®—æ³•
            const shuffled = [...taskPool].sort(() => 0.5 - Math.random());
            todayTasks = shuffled.slice(0, 3).map(t => ({ ...t, done: false }));
            
            saveData();
            renderToday();
        }

        // å®Œæˆä»»å‹™
        function completeTask(index) {
            if (todayTasks[index].done) return;
            
            todayTasks[index].done = true;
            totalScore += parseInt(todayTasks[index].difficulty);
            
            saveData();
            renderScore();
            renderToday();
        }

        // æ–°å¢ä»»å‹™åˆ°åº«å­˜
        function addNewTask() {
            const input = document.getElementById('newTaskCmd');
            const diff = document.getElementById('newTaskDiff').value;
            
            if (input.value.trim() === "") return;

            taskPool.push({ cmd: input.value, difficulty: parseInt(diff) });
            input.value = ""; // æ¸…ç©ºè¼¸å…¥æ¡†
            
            saveData();
            renderPool();
        }

        // åˆªé™¤åº«å­˜ä¸­çš„ä»»å‹™
        function deleteTask(index) {
            taskPool.splice(index, 1);
            saveData();
            renderPool();
        }

        // --- 4. ç•«é¢æ¸²æŸ“èˆ‡å„²å­˜ ---

        function saveData() {
            localStorage.setItem('myTaskPool', JSON.stringify(taskPool));
            localStorage.setItem('myTotalScore', totalScore.toString());
            localStorage.setItem('myTodayTasks', JSON.stringify(todayTasks));
        }

        function renderScore() {
            document.getElementById('scoreDisplay').innerText = totalScore;
        }

        function renderToday() {
            const container = document.getElementById('todayDisplay');
            if (todayTasks.length === 0) {
                container.innerHTML = "<p style='text-align:center; color:#999;'>è«‹é»æ“Šä¸Šæ–¹æŒ‰éˆ•æŠ½å–ä»»å‹™</p>";
                return;
            }

            container.innerHTML = todayTasks.map((t, i) => `
                <div class="task-item">
                    <span style="${t.done ? 'text-decoration: line-through; color: #aaa;' : ''}">
                        <b>${t.cmd}</b> <small>(${t.difficulty}åˆ†)</small>
                    </span>
                    <button class="btn btn-success" onclick="completeTask(${i})" ${t.done ? 'disabled' : ''}>
                        ${t.done ? 'å·²å®Œæˆ' : 'å®Œæˆ'}
                    </button>
                </div>
            `).join('');
        }

        function renderPool() {
            const container = document.getElementById('poolDisplay');
            container.innerHTML = taskPool.map((t, i) => `
                <div class="task-item">
                    <span>${t.cmd} <span class="tag diff-${t.difficulty}">${t.difficulty}åˆ†</span></span>
                    <button class="btn btn-danger" onclick="deleteTask(${i})">åˆªé™¤</button>
                </div>
            `).join('');
        }

        // å•Ÿå‹•ï¼
        init();
    </script>
</body>
</html>
